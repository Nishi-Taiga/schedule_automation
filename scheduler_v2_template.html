<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ™‚é–“å‰²è‡ªå‹•ä½œæˆã‚·ã‚¹ãƒ†ãƒ  - SmartScheduler</title>
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
  <style>
    /* ========== ãƒªã‚»ãƒƒãƒˆ & åŸºæœ¬è¨­å®š ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #60a5fa;
      --success: #10b981;
      --success-dark: #059669;
      --warning: #f59e0b;
      --error: #ef4444;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
      line-height: 1.6;
      color: var(--gray-900);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    /* ========== ã‚³ãƒ³ãƒ†ãƒŠ ========== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ========== ãƒ˜ãƒƒãƒ€ãƒ¼ ========== */
    .header {
      background: white;
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-lg);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .header-title {
      display: flex;
      flex-direction: column;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 14px;
      color: var(--gray-500);
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    /* ========== ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ ========== */
    .steps {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-md);
    }

    .steps-container {
      display: flex;
      justify-content: space-between;
      position: relative;
    }

    .step {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .step-number {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--gray-200);
      color: var(--gray-500);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 12px;
      transition: all 0.3s;
    }

    .step.active .step-number {
      background: var(--primary);
      color: white;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
    }

    .step.completed .step-number {
      background: var(--success);
      color: white;
    }

    .step-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-600);
      text-align: center;
    }

    .step.active .step-label {
      color: var(--primary);
      font-weight: 600;
    }

    .steps-connector {
      position: absolute;
      top: 24px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--gray-200);
      z-index: 0;
    }

    /* ========== ã‚«ãƒ¼ãƒ‰ ========== */
    .card {
      background: white;
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-md);
      transition: box-shadow 0.3s;
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary-light), var(--primary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--gray-900);
    }

    .card-description {
      font-size: 14px;
      color: var(--gray-500);
      margin-bottom: 20px;
    }

    /* ========== ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ========== */
    .upload-area {
      border: 2px dashed var(--gray-300);
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      background: var(--gray-50);
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.05);
    }

    .upload-area.dragover {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.1);
      transform: scale(1.02);
    }

    .upload-area.uploaded {
      border-color: var(--success);
      background: rgba(16, 185, 129, 0.05);
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .upload-text {
      font-size: 16px;
      font-weight: 500;
      color: var(--gray-700);
      margin-bottom: 8px;
    }

    .upload-hint {
      font-size: 14px;
      color: var(--gray-500);
    }

    .file-input {
      display: none;
    }

    .file-info {
      margin-top: 16px;
      padding: 12px;
      background: var(--gray-100);
      border-radius: 8px;
      display: none;
    }

    .file-info.show {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .file-name {
      flex: 1;
      font-size: 14px;
      color: var(--gray-700);
      font-weight: 500;
    }

    .file-size {
      font-size: 12px;
      color: var(--gray-500);
    }

    .remove-file {
      padding: 4px 12px;
      background: var(--error);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .remove-file:hover {
      background: #dc2626;
    }

    /* ========== ãƒœã‚¿ãƒ³ ========== */
    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), var(--success-dark));
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-success:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      background: white;
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--gray-50);
      border-color: var(--gray-400);
    }

    .btn-lg {
      padding: 16px 32px;
      font-size: 18px;
    }

    .btn-block {
      width: 100%;
      justify-content: center;
    }

    /* ========== ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ ========== */
    .progress-container {
      margin: 20px 0;
      display: none;
    }

    .progress-container.show {
      display: block;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--gray-200);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      transition: width 0.3s;
      border-radius: 4px;
    }

    .progress-text {
      font-size: 14px;
      color: var(--gray-600);
      text-align: center;
    }

    /* ========== ã‚¢ãƒ©ãƒ¼ãƒˆ ========== */
    .alert {
      padding: 16px;
      border-radius: 10px;
      margin: 16px 0;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--success);
      color: var(--success-dark);
    }

    .alert-warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid var(--warning);
      color: #d97706;
    }

    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--error);
      color: #dc2626;
    }

    .alert-info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid var(--primary);
      color: var(--primary-dark);
    }

    .alert-icon {
      font-size: 20px;
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .alert-message {
      font-size: 14px;
    }

    /* ========== çµ±è¨ˆæƒ…å ± ========== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .stat-card {
      padding: 20px;
      background: var(--gray-50);
      border-radius: 12px;
      border: 1px solid var(--gray-200);
    }

    .stat-label {
      font-size: 14px;
      color: var(--gray-500);
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .stat-unit {
      font-size: 16px;
      color: var(--gray-600);
      margin-left: 4px;
    }

    /* ========== ãƒ†ãƒ¼ãƒ–ãƒ« ========== */
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
    }

    th {
      background: var(--gray-50);
      font-weight: 600;
      color: var(--gray-700);
      font-size: 14px;
    }

    td {
      font-size: 14px;
      color: var(--gray-600);
    }

    tr:hover {
      background: var(--gray-50);
    }

    /* ========== ãƒ¢ãƒ¼ãƒ€ãƒ« ========== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: var(--gray-100);
      color: var(--gray-600);
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: var(--gray-200);
    }

    /* ========== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– ========== */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }

      .header {
        padding: 20px;
      }

      h1 {
        font-size: 24px;
      }

      .card {
        padding: 20px;
      }

      .steps-container {
        flex-direction: column;
        gap: 20px;
      }

      .steps-connector {
        display: none;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ========== ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ ========== */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--gray-200);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      z-index: 999;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 20px;
    }

    .loading-overlay.show {
      display: flex;
    }

    .loading-text {
      font-size: 18px;
      font-weight: 600;
      color: var(--gray-700);
    }
  </style>
</head>
<body>
  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text" id="loadingText">å‡¦ç†ä¸­...</div>
  </div>

  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <div class="header-content">
        <div class="logo-section">
          <div class="logo">ğŸ“…</div>
          <div class="header-title">
            <h1>SmartScheduler</h1>
            <div class="subtitle">å€‹åˆ¥æŒ‡å°å¡¾ãƒ»æ™‚é–“å‰²è‡ªå‹•ä½œæˆã‚·ã‚¹ãƒ†ãƒ  v1.3</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="showHelp()">
            ğŸ“– ãƒ˜ãƒ«ãƒ—
          </button>
          <button class="btn btn-secondary" onclick="downloadSampleData()">
            ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
          </button>
        </div>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div class="steps">
      <div class="steps-container">
        <div class="steps-connector"></div>
        <div class="step active" id="step1">
          <div class="step-number">1</div>
          <div class="step-label">ãƒ–ãƒ¼ã‚¹è¡¨</div>
        </div>
        <div class="step" id="step2">
          <div class="step-number">2</div>
          <div class="step-label">è¬›å¸«è¡¨</div>
        </div>
        <div class="step" id="step3">
          <div class="step-number">3</div>
          <div class="step-label">ç”Ÿå¾’æƒ…å ±</div>
        </div>
        <div class="step" id="step4">
          <div class="step-number">4</div>
          <div class="step-label">è¨­å®š</div>
        </div>
        <div class="step" id="step5">
          <div class="step-number">5</div>
          <div class="step-label">å®Ÿè¡Œ</div>
        </div>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ–ãƒ¼ã‚¹è¡¨ -->
    <div class="card" id="card1">
      <div class="card-header">
        <div class="card-icon">ğŸ“‹</div>
        <div>
          <div class="card-title">ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ–ãƒ¼ã‚¹è¡¨ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
        </div>
      </div>
      <div class="card-description">
        ãƒ–ãƒ¼ã‚¹è¡¨ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.xlsxï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã§ãã¾ã™ã€‚
      </div>
      <div class="upload-area" id="boothUploadArea" onclick="document.getElementById('boothFileInput').click()">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text">ãƒ–ãƒ¼ã‚¹è¡¨ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
        <div class="upload-hint">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
        <input type="file" id="boothFileInput" class="file-input" accept=".xlsx,.xls" />
      </div>
      <div class="file-info" id="boothFileInfo">
        <span class="file-name" id="boothFileName"></span>
        <span class="file-size" id="boothFileSize"></span>
        <button class="remove-file" onclick="removeFile('booth')">âœ• å‰Šé™¤</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—2: è¬›å¸«è¡¨ -->
    <div class="card" id="card2">
      <div class="card-header">
        <div class="card-icon">ğŸ‘¨â€ğŸ«</div>
        <div>
          <div class="card-title">ã‚¹ãƒ†ãƒƒãƒ—2: è¬›å¸«è¡¨ï¼ˆå…ƒã‚·ãƒ¼ãƒˆï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
        </div>
      </div>
      <div class="card-description">
        è¬›å¸«ã®æå‡ºã‚·ãƒ•ãƒˆï¼ˆå…ƒã‚·ãƒ¼ãƒˆï¼‰ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.xlsxï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
      </div>
      <div class="upload-area" id="teacherUploadArea" onclick="document.getElementById('teacherFileInput').click()">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text">è¬›å¸«è¡¨ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
        <div class="upload-hint">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
        <input type="file" id="teacherFileInput" class="file-input" accept=".xlsx,.xls" />
      </div>
      <div class="file-info" id="teacherFileInfo">
        <span class="file-name" id="teacherFileName"></span>
        <span class="file-size" id="teacherFileSize"></span>
        <button class="remove-file" onclick="removeFile('teacher')">âœ• å‰Šé™¤</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ç”Ÿå¾’ãƒ»è¬›å¸«æƒ…å ± -->
    <div class="card" id="card3">
      <div class="card-header">
        <div class="card-icon">ğŸ‘¥</div>
        <div>
          <div class="card-title">ã‚¹ãƒ†ãƒƒãƒ—3: ç”Ÿå¾’ãƒ»è¬›å¸«æƒ…å ±ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</div>
        </div>
      </div>
      <div class="card-description">
        ç”Ÿå¾’ã®ç§‘ç›®åˆ¥ã‚³ãƒæ•°ã¨è¬›å¸«ã®æŒ‡å°å¯èƒ½ç§‘ç›®ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.xlsxï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®å ´åˆã¯è¬›å¸«ã®ã¿å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
      </div>
      <div class="upload-area" id="studentUploadArea" onclick="document.getElementById('studentFileInput').click()">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text">ç”Ÿå¾’ãƒ»è¬›å¸«æƒ…å ±ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
        <div class="upload-hint">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</div>
        <input type="file" id="studentFileInput" class="file-input" accept=".xlsx,.xls" />
      </div>
      <div class="file-info" id="studentFileInfo">
        <span class="file-name" id="studentFileName"></span>
        <span class="file-size" id="studentFileSize"></span>
        <button class="remove-file" onclick="removeFile('student')">âœ• å‰Šé™¤</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—4: è¨­å®š -->
    <div class="card" id="card4">
      <div class="card-header">
        <div class="card-icon">âš™ï¸</div>
        <div>
          <div class="card-title">ã‚¹ãƒ†ãƒƒãƒ—4: å„ªå…ˆãƒ–ãƒ¼ã‚¹è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</div>
        </div>
      </div>
      <div class="card-description">
        è¬›å¸«ã”ã¨ã«å„ªå…ˆçš„ã«é…ç½®ã™ã‚‹ãƒ–ãƒ¼ã‚¹ã‚’è¨­å®šã§ãã¾ã™ã€‚è¨­å®šã¯è‡ªå‹•çš„ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
      </div>
      <button class="btn btn-secondary" id="showPreferenceBtn">
        âš™ï¸ å„ªå…ˆãƒ–ãƒ¼ã‚¹è¨­å®šã‚’è¡¨ç¤º
      </button>
      <div id="preferenceSection" style="display:none; margin-top:20px;">
        <div class="table-container">
          <table id="preferenceTable">
            <thead>
              <tr>
                <th>è¬›å¸«å</th>
                <th>å„ªå…ˆãƒ–ãƒ¼ã‚¹</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="preferenceTableBody">
              <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—5: å®Ÿè¡Œ -->
    <div class="card" id="card5">
      <div class="card-header">
        <div class="card-icon">â–¶ï¸</div>
        <div>
          <div class="card-title">ã‚¹ãƒ†ãƒƒãƒ—5: è‡ªå‹•å‰²ã‚Šå½“ã¦ã‚’å®Ÿè¡Œ</div>
        </div>
      </div>
      <div class="card-description">
        å…¨ã¦ã®å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€è‡ªå‹•å‰²ã‚Šå½“ã¦ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
      </div>
      <button class="btn btn-primary btn-lg btn-block" id="runBtn" disabled>
        ğŸš€ è‡ªå‹•å‰²ã‚Šå½“ã¦ã‚’å®Ÿè¡Œ
      </button>
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">å‡¦ç†ä¸­...</div>
      </div>
      <div id="alertContainer"></div>
    </div>

    <!-- çµæœè¡¨ç¤º -->
    <div class="card" id="resultCard" style="display:none;">
      <div class="card-header">
        <div class="card-icon">ğŸ“Š</div>
        <div>
          <div class="card-title">å‰²ã‚Šå½“ã¦çµæœ</div>
        </div>
      </div>

      <!-- çµ±è¨ˆæƒ…å ± -->
      <div class="stats-grid" id="statsGrid">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
      </div>

      <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div style="display:flex; gap:12px; margin-top:24px;">
        <button class="btn btn-success btn-lg" id="downloadExcelBtn">
          ğŸ“¥ è¬›å¸«é…ç½®æ¸ˆã¿ãƒ–ãƒ¼ã‚¹è¡¨.xlsxã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
        <button class="btn btn-secondary" id="downloadReportBtn">
          ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆï¼ˆCSVï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        </button>
      </div>

      <!-- è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <div class="table-container" id="resultTableContainer" style="margin-top:24px;">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</div>
        <button class="modal-close" onclick="closeHelp()">âœ•</button>
      </div>
      <div class="modal-body">
        <h3 style="margin-bottom:16px;">ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦</h3>
        <p style="margin-bottom:20px;">
          SmartSchedulerã¯å€‹åˆ¥æŒ‡å°å¡¾ã®æ™‚é–“å‰²ä½œæˆã‚’è‡ªå‹•åŒ–ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
          ãƒ–ãƒ¼ã‚¹è¡¨ã€è¬›å¸«è¡¨ã€ç”Ÿå¾’æƒ…å ±ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã ã‘ã§ã€
          æœ€é©ãªè¬›å¸«é…ç½®ã¨ç”Ÿå¾’å‰²ã‚Šå½“ã¦ã‚’è‡ªå‹•çš„ã«è¡Œã„ã¾ã™ã€‚
        </p>

        <h3 style="margin-bottom:16px;">ğŸš€ ä½¿ã„æ–¹</h3>
        <ol style="padding-left:20px; margin-bottom:20px;">
          <li style="margin-bottom:12px;"><strong>ãƒ–ãƒ¼ã‚¹è¡¨ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</strong> æ—¥ä»˜Ã—æ™‚é–“Ã—ãƒ–ãƒ¼ã‚¹ã®ãƒãƒˆãƒªã‚¯ã‚¹Excelãƒ•ã‚¡ã‚¤ãƒ«</li>
          <li style="margin-bottom:12px;"><strong>è¬›å¸«è¡¨ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</strong> è¬›å¸«ã®æå‡ºã‚·ãƒ•ãƒˆï¼ˆå…ƒã‚·ãƒ¼ãƒˆï¼‰Excelãƒ•ã‚¡ã‚¤ãƒ«</li>
          <li style="margin-bottom:12px;"><strong>ç”Ÿå¾’æƒ…å ±ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:</strong> ç”Ÿå¾’ã‚³ãƒæ•°è¡¨ã¨è¬›å¸«ã®æŒ‡å°å¯èƒ½ç§‘ç›®</li>
          <li style="margin-bottom:12px;"><strong>å„ªå…ˆãƒ–ãƒ¼ã‚¹è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰:</strong> è¬›å¸«ã”ã¨ã«å„ªå…ˆãƒ–ãƒ¼ã‚¹ã‚’è¨­å®š</li>
          <li style="margin-bottom:12px;"><strong>å®Ÿè¡Œ:</strong> è‡ªå‹•å‰²ã‚Šå½“ã¦ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
        </ol>

        <h3 style="margin-bottom:16px;">ğŸ’¡ æ©Ÿèƒ½</h3>
        <ul style="padding-left:20px; margin-bottom:20px;">
          <li style="margin-bottom:8px;">âœ… è¬›å¸«-ç§‘ç›®ãƒãƒƒãƒãƒ³ã‚°ï¼ˆè¬›å¸«ãŒæ•™ãˆã‚‰ã‚Œã‚‹ç§‘ç›®ã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼‰</li>
          <li style="margin-bottom:8px;">âœ… NGç”Ÿå¾’å‡¦ç†ï¼ˆåŒã˜æ™‚é–“å¸¯ã®NGç”Ÿå¾’ã‚’è‡ªå‹•å›é¿ï¼‰</li>
          <li style="margin-bottom:8px;">âœ… å¸Œæœ›è¬›å¸«å„ªå…ˆãƒãƒƒãƒãƒ³ã‚°</li>
          <li style="margin-bottom:8px;">âœ… 1æ—¥å†…ãƒ–ãƒ¼ã‚¹å›ºå®šï¼ˆè¬›å¸«ã¯1æ—¥ã‚’é€šã—ã¦åŒã˜ãƒ–ãƒ¼ã‚¹ã‚’ä½¿ç”¨ï¼‰</li>
          <li style="margin-bottom:8px;">âœ… å‡ºå‹¤æ™‚åˆ»å„ªå…ˆï¼ˆæ—©ãæ¥ã‚‹è¬›å¸«ã‚’å„ªå…ˆé…ç½®ï¼‰</li>
        </ul>

        <h3 style="margin-bottom:16px;">ğŸ“ ã‚µãƒãƒ¼ãƒˆ</h3>
        <p>
          å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
          è©³ç´°ãªãƒ­ã‚°ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã§ç¢ºèªã§ãã¾ã™ã€‚
        </p>
      </div>
    </div>
  </div>

  <script>
    // ========== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ==========
    let boothData = null;
    let teacherData = null;
    let studentDemandData = null;
    let teacherSubjectMap = {};
    let teacherPreferences = {};
    let lastAssignments = [];

    // ========== åˆæœŸåŒ– ==========
    document.addEventListener('DOMContentLoaded', function() {
      initDragAndDrop();
      initFileInputs();
      loadPreferences();
      console.log('âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
    });

    // ========== ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ==========
    function initDragAndDrop() {
      const areas = [
        { area: 'boothUploadArea', input: 'boothFileInput' },
        { area: 'teacherUploadArea', input: 'teacherFileInput' },
        { area: 'studentUploadArea', input: 'studentFileInput' }
      ];

      areas.forEach(({ area, input }) => {
        const areaEl = document.getElementById(area);
        const inputEl = document.getElementById(input);

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          areaEl.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
          areaEl.addEventListener(eventName, () => {
            areaEl.classList.add('dragover');
          }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
          areaEl.addEventListener(eventName, () => {
            areaEl.classList.remove('dragover');
          }, false);
        });

        areaEl.addEventListener('drop', function(e) {
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            inputEl.files = files;
            const event = new Event('change', { bubbles: true });
            inputEl.dispatchEvent(event);
          }
        }, false);
      });
    }

    // ========== ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ› ==========
    function initFileInputs() {
      document.getElementById('boothFileInput').addEventListener('change', function(e) {
        handleFileSelect(e.target.files[0], 'booth');
      });

      document.getElementById('teacherFileInput').addEventListener('change', function(e) {
        handleFileSelect(e.target.files[0], 'teacher');
      });

      document.getElementById('studentFileInput').addEventListener('change', function(e) {
        handleFileSelect(e.target.files[0], 'student');
      });
    }

    async function handleFileSelect(file, type) {
      if (!file) return;

      console.log(`ğŸ“‚ ${type}ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ:`, file.name);

      // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
      const areaId = type + 'UploadArea';
      const infoId = type + 'FileInfo';
      const nameId = type + 'FileName';
      const sizeId = type + 'FileSize';

      document.getElementById(areaId).classList.add('uploaded');
      document.getElementById(infoId).classList.add('show');
      document.getElementById(nameId).textContent = file.name;
      document.getElementById(sizeId).textContent = formatFileSize(file.size);

      // ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°
      updateStepStatus(type, 'completed');

      // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
      showLoading(`${file.name}ã‚’èª­ã¿è¾¼ã¿ä¸­...`);
      try {
        if (type === 'booth') {
          boothData = await parseBoothExcel(file);
          console.log('âœ… ãƒ–ãƒ¼ã‚¹è¡¨èª­ã¿è¾¼ã¿å®Œäº†:', boothData.length, 'ã‚¹ãƒ­ãƒƒãƒˆ');
          showAlert('success', 'ãƒ–ãƒ¼ã‚¹è¡¨ã®èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸ', `${boothData.length}å€‹ã®ã‚¹ãƒ­ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
        } else if (type === 'teacher') {
          teacherData = await parseTeacherExcel(file);
          console.log('âœ… è¬›å¸«è¡¨èª­ã¿è¾¼ã¿å®Œäº†:', teacherData.length, 'ä»¶');
          showAlert('success', 'è¬›å¸«è¡¨ã®èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸ', `${teacherData.length}ä»¶ã®è¬›å¸«å¯ç”¨æ ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
          updatePreferenceTable();
        } else if (type === 'student') {
          const result = await parseStudentDemandExcel(file);
          studentDemandData = result.studentDemands;
          teacherSubjectMap = result.teacherSubjectMap;
          console.log('âœ… ç”Ÿå¾’æƒ…å ±èª­ã¿è¾¼ã¿å®Œäº†:', studentDemandData.length, 'ä»¶ã®éœ€è¦');
          console.log('âœ… è¬›å¸«-ç§‘ç›®ãƒãƒƒãƒ—:', Object.keys(teacherSubjectMap).length, 'åã®è¬›å¸«');
          showAlert('success', 'ç”Ÿå¾’ãƒ»è¬›å¸«æƒ…å ±ã®èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸ',
            `${studentDemandData.length}ä»¶ã®ç”Ÿå¾’éœ€è¦ã€${Object.keys(teacherSubjectMap).length}åã®è¬›å¸«æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
        }

        checkReadyToRun();
      } catch (error) {
        console.error('âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        showAlert('error', 'ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', error.message);
        removeFile(type);
      } finally {
        hideLoading();
      }
    }

    function removeFile(type) {
      const areaId = type + 'UploadArea';
      const infoId = type + 'FileInfo';
      const inputId = type + 'FileInput';

      document.getElementById(areaId).classList.remove('uploaded');
      document.getElementById(infoId).classList.remove('show');
      document.getElementById(inputId).value = '';

      if (type === 'booth') {
        boothData = null;
      } else if (type === 'teacher') {
        teacherData = null;
      } else if (type === 'student') {
        studentDemandData = null;
        teacherSubjectMap = {};
      }

      updateStepStatus(type, 'active');
      checkReadyToRun();
    }

    // ========== ã‚¹ãƒ†ãƒƒãƒ—ç®¡ç† ==========
    function updateStepStatus(type, status) {
      const stepMap = {
        'booth': 'step1',
        'teacher': 'step2',
        'student': 'step3'
      };

      const stepId = stepMap[type];
      if (stepId) {
        const step = document.getElementById(stepId);
        step.classList.remove('active', 'completed');
        step.classList.add(status);
      }
    }

    function checkReadyToRun() {
      const ready = boothData && teacherData;
      document.getElementById('runBtn').disabled = !ready;

      if (ready) {
        document.getElementById('step5').classList.add('active');
      }
    }

    // ========== UI ãƒ˜ãƒ«ãƒ‘ãƒ¼ ==========
    function showLoading(text = 'å‡¦ç†ä¸­...') {
      document.getElementById('loadingText').textContent = text;
      document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }

    function showAlert(type, title, message) {
      const container = document.getElementById('alertContainer');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.innerHTML = `
        <div class="alert-icon">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</div>
        <div class="alert-content">
          <div class="alert-title">${title}</div>
          <div class="alert-message">${message}</div>
        </div>
      `;
      container.appendChild(alert);

      // 5ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // ========== ãƒ¢ãƒ¼ãƒ€ãƒ« ==========
    function showHelp() {
      document.getElementById('helpModal').classList.add('show');
    }

    function closeHelp() {
      document.getElementById('helpModal').classList.remove('show');
    }

    function downloadSampleData() {
      showAlert('info', 'ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿', 'æº–å‚™ä¸­ã§ã™ã€‚å¾Œã»ã©è¿½åŠ äºˆå®šã§ã™ã€‚');
    }

    // ========== è¨­å®šç®¡ç† ==========
    function loadPreferences() {
      const saved = localStorage.getItem('teacherPreferences');
      if (saved) {
        teacherPreferences = JSON.parse(saved);
        console.log('âœ… ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
      }
    }

    function savePreferences() {
      localStorage.setItem('teacherPreferences', JSON.stringify(teacherPreferences));
      console.log('âœ… è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      showAlert('success', 'è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'å„ªå…ˆãƒ–ãƒ¼ã‚¹è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ');
    }

    function updatePreferenceTable() {
      // TODO: å®Ÿè£…
      console.log('å„ªå…ˆãƒ–ãƒ¼ã‚¹è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°');
    }

    // ========== Excelãƒ‘ãƒ¼ã‚¹é–¢æ•°ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰ ==========
    async function parseBoothExcel(file) {
      // TODO: æ—¢å­˜ã®parseBoothExcelå®Ÿè£…ã‚’ã“ã“ã«çµ±åˆ
      return [];
    }

    async function parseTeacherExcel(file) {
      // TODO: æ—¢å­˜ã®parseTeacherExcelå®Ÿè£…ã‚’ã“ã“ã«çµ±åˆ
      return [];
    }

    async function parseStudentDemandExcel(file) {
      // TODO: æ—¢å­˜ã®parseStudentDemandExcelå®Ÿè£…ã‚’ã“ã“ã«çµ±åˆ
      return { studentDemands: [], teacherSubjectMap: {} };
    }

    console.log('ğŸ“… SmartScheduler v1.3 - Ready');
  </script>
</body>
</html>
