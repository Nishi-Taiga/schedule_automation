# 生徒割り当て確認ガイド

## 自動テストが実行できない理由
Playwright自動テストは、この環境ではCDN (cdn.jsdelivr.net) へのアクセスが403 Forbiddenでブロックされるため実行できません。
しかし、ブラウザで直接開く場合は正常に動作します。

## 手動での確認手順

### 1. scheduler.htmlを開く
1. ブラウザでscheduler.htmlを開く
2. ブース表テンプレート.xlsxを読み込み
3. 生徒・講師情報.xlsxを読み込み
4. 「講師の割り当てを実行」をクリック

### 2. 生徒を個別に割り当てる
1. 講師割り当て完了後、画面下部に「生徒選択」エリアが表示されることを確認
2. プルダウンから生徒を1人選択
3. 「選択した生徒を割り当て」ボタンをクリック
4. ステータスメッセージに「〇〇(生徒名) を割り当てました」と表示されることを確認

### 3. 複数の生徒で繰り返しテスト
- 最低5人の生徒で上記手順を繰り返し、すべて正常に割り当てられることを確認

### 4. 割り当て結果の確認

#### A. CSV出力で確認
1. 「割り当て結果(CSV)」テキストエリアを確認
2. 以下の形式でデータが出力されていることを確認:
   ```
   曜日,日付,時間,ブース,講師,生徒,授業内容,志望校
   ```
3. 生徒名が「生徒」列に正しく記載されていることを確認
4. 各生徒の必要コマ数に応じた行数があることを確認

#### B. 必要コマ数確認表で確認
1. 「必要コマ数確認表を表示」ボタンをクリック
2. テーブルが表示される
3. 各生徒の行を確認:
   - **必要コマ数**: 生徒が必要とする総コマ数
   - **割当済コマ数**: 実際に割り当てられたコマ数
   - **達成率**: 割当済 / 必要コマ数 × 100%

4. 確認ポイント:
   - 達成率が100%に近い生徒が多いこと
   - 割当済コマ数が0でない生徒が多いこと
   - 達成率が低い生徒がいる場合、その理由を調査:
     - 講師の空きがない
     - 時間帯の制約(希望時間と講師のコマが合わない)
     - NG制約

#### C. 検知レポートで確認
1. 「検知レポート(CSV)」テキストエリアを確認
2. 以下の警告/エラーが記録されていないか確認:
   - `⚠️ 生徒の必要コマ数が不足しています`
   - `❌ 講師が見つかりませんでした`
   - `⚠️ 講師の移動が検出されました`

#### D. 実行ログで確認
1. 「実行ログ(テキスト)保存」ボタンをクリックしてログをダウンロード
2. ログを開いて以下を確認:
   - 生徒需要数: `✓ 生徒需要: XXX件`
   - 各生徒の割り当て結果: `✓ 生徒XXXを割り当てました: Y件のコマ`
   - エラーや警告がないか

### 5. 期待される結果

✅ **正常な場合**:
- すべての生徒が選択可能
- 「選択した生徒を割り当て」をクリックすると正常に割り当てられる
- CSV出力に生徒名が表示される
- 必要コマ数確認表で割当済コマ数が増える
- 達成率が100%または高い割合になる

❌ **異常な場合**:
- 生徒を選択できない
- 割り当てボタンをクリックしてもエラーが出る
- CSV出力に生徒名が表示されない
- 割当済コマ数が0のまま
- 達成率が0%または極端に低い

## トラブルシューティング

### 生徒が割り当てられない場合
1. **講師の空きがない**: 必要コマ数 > 講師の提供可能コマ数
2. **時間制約**: 生徒の希望時間と講師の対応可能時間が合わない
3. **NG制約**: NGリストで除外されている
4. **ブラウザのコンソールログを確認**: F12 → Console タブでエラーメッセージを確認

### データの整合性確認
```javascript
// ブラウザのコンソールで実行
console.log('総ブース数:', assignments.length);
console.log('生徒が割り当てられているブース数:', assignments.filter(a => a.studentId).length);
console.log('講師のみのブース数:', assignments.filter(a => !a.studentId).length);
```

## 自動テストを実行したい場合

ローカル環境(制限のないネットワーク)で以下を実行:

```bash
# Playwrightをインストール
pip install playwright
playwright install chromium

# テストを実行
python3 test_scheduler.py
```

このテストは以下を自動で確認します:
- ファイルの読み込み
- 講師の自動割り当て
- 最初の5人の生徒の割り当て
- CSV出力の生成
- 必要コマ数確認表の表示
- スクリーンショットの保存
